@using AubgEMS.Core.Models.Events
@model EventDetailsDto

@{
    ViewData["Title"] = Model.Title;
}

<!-- status / toast-style alert via TempData -->
<partial name="_StatusMessage" />

<div class="row">
    <div class="col-lg-8">
        <h1 class="mb-3">@Model.Title</h1>
        <p class="text-muted mb-2">
            <strong>@Model.EventTypeName</strong> · @Model.ClubName
        </p>
        <p class="text-muted mb-2">
            @Model.StartTime.ToString("f")
            @if (!string.IsNullOrWhiteSpace(Model.LocationName))
            {
                <span> · @Model.LocationName</span>
            }
        </p>
        <p class="text-muted mb-3">Capacity: @Model.Capacity</p>

        @* JOIN / LEAVE block (signed-in users only) *@
        @if (User?.Identity?.IsAuthenticated ?? false)
        {
            <div class="mb-3">
                @if ((bool)(ViewBag.JoinedByMe ?? false))
                {
                    <form asp-controller="Events" asp-action="Leave" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@Model.Id" />
                        <input type="hidden" name="returnUrl"
                               value="@Url.Action("Details","Events", new { id = Model.Id })" />
                        <button type="submit"
                                class="btn btn-outline-danger btn-sm"
                                onclick="return confirm('Leave this event?');">
                            Leave
                        </button>
                    </form>
                }
                else
                {
                    <form asp-controller="Events" asp-action="Join" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@Model.Id" />
                        <input type="hidden" name="returnUrl"
                               value="@Url.Action("Details","Events", new { id = Model.Id })" />
                        <button type="submit" class="btn btn-primary btn-sm">Join</button>
                    </form>
                }
            </div>
        }

        <article>
            @Model.Description
        </article>
    </div>

    <div class="col-lg-4">
        @if (!string.IsNullOrWhiteSpace(Model.ImageUrl))
        {
            <img class="img-fluid rounded shadow-sm" src="@Model.ImageUrl" alt="@Model.Title" />
        }
    </div>
</div>

<p class="mt-4">
    <a asp-action="Index" class="btn btn-outline-secondary">Back to Events</a>
</p>
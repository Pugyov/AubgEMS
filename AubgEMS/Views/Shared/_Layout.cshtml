@using AubgEMS.Core.Constants
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - AubgEMS</title>

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body class="d-flex flex-column min-vh-100">
@functions{
    // Area-aware "active" helper. Pass only what you want to match.
    string Active(string? controller = null, string? action = null, string? area = null)
    {
        var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
        var currentAction     = ViewContext.RouteData.Values["action"]?.ToString();
        var currentArea       = ViewContext.RouteData.Values["area"]?.ToString() ?? "";

        bool controllerMatch = controller is null || string.Equals(currentController, controller, StringComparison.OrdinalIgnoreCase);
        bool actionMatch     = action     is null || string.Equals(currentAction,     action,     StringComparison.OrdinalIgnoreCase);
        bool areaMatch       = area       is null || string.Equals(currentArea,       area,       StringComparison.OrdinalIgnoreCase);

        return (controllerMatch && actionMatch && areaMatch) ? "active" : "";
    }
}
@{
    var isSignedIn  = User?.Identity?.IsAuthenticated ?? false;
    var isAdmin     = User?.IsInRole(RoleNames.Admin) ?? false;
    var isOrganizer = User?.IsInRole(RoleNames.Organizer) ?? false;
}

<!-- Skip link for keyboard users -->
<a class="visually-hidden-focusable position-absolute top-0 start-0 p-2 m-2 bg-white border rounded"
   href="#content">Skip to main content</a>

<header>
    <nav class="navbar navbar-expand-sm navbar-light bg-white border-bottom box-shadow mb-3 py-2 py-sm-0">
        <div class="container-fluid">
            <a class="navbar-brand fw-semibold" asp-area="" asp-controller="Home" asp-action="Index">AubgEMS</a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"
                    aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div id="mainNav" class="navbar-collapse collapse justify-content-between">
                <ul class="navbar-nav me-auto mb-2 mb-sm-0">
                    <li class="nav-item">
                        @{
                            var aHome = Active(controller: "Home", action: "Index", area: "");
                        }
                        <a class="nav-link px-2 @aHome"
                           aria-current="@(aHome == "active" ? "page" : null)"
                           asp-area="" asp-controller="Home" asp-action="Index">
                            Home
                        </a>
                    </li>
                    <li class="nav-item">
                        @{
                            var aEvents = Active(controller: "Events", area: "");
                        }
                        <a class="nav-link px-2 @aEvents"
                           aria-current="@(aEvents == "active" ? "page" : null)"
                           asp-area="" asp-controller="Events" asp-action="Index">
                            Events
                        </a>
                    </li>
                    <li class="nav-item">
                        @{
                            var aNews = Active(controller: "News", area: "");
                        }
                        <a class="nav-link px-2 @aNews"
                           aria-current="@(aNews == "active" ? "page" : null)"
                           asp-area="" asp-controller="News" asp-action="Index">
                            News
                        </a>
                    </li>
                    <li class="nav-item">
                        @{
                            var aClubs = Active(controller: "Clubs", area: "");
                        }
                        <a class="nav-link px-2 @aClubs"
                           aria-current="@(aClubs == "active" ? "page" : null)"
                           asp-area="" asp-controller="Clubs" asp-action="Index">
                            Clubs
                        </a>
                    </li>

                    @if (isSignedIn)
                    {
                        <li class="nav-item">
                            @{
                                var aMy = Active(controller: "My", area: "");
                            }
                            <a class="nav-link px-2 @aMy"
                               aria-current="@(aMy == "active" ? "page" : null)"
                               asp-area="" asp-controller="My" asp-action="Events">
                                My Events
                            </a>
                        </li>
                    }

                    @if (isAdmin)
                    {
                        <li class="nav-item">
                            @{
                                var aAdmin = Active(area: "Admin");
                            }
                            <a class="nav-link px-2 @aAdmin"
                               aria-current="@(aAdmin == "active" ? "page" : null)"
                               asp-area="Admin" asp-controller="Dashboard" asp-action="Index">
                                Admin
                            </a>
                        </li>
                    }

                    @if (isOrganizer || isAdmin)
                    {
                        <li class="nav-item">
                            @{
                                var aOrg = Active(area: "Organizer");
                            }
                            <a class="nav-link px-2 @aOrg"
                               aria-current="@(aOrg == "active" ? "page" : null)"
                               asp-area="Organizer" asp-controller="Events" asp-action="Index">
                                Organizer
                            </a>
                        </li>
                    }
                </ul>

                <div class="ms-sm-3">
                    <partial name="_LoginPartial" />
                </div>
            </div>
        </div>
    </nav>
</header>

<div class="container flex-grow-1">
    <main id="content" role="main" class="pb-4">
        @RenderBody()
    </main>
</div>

<partial name="_Footer" />

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/js/site.js" asp-append-version="true"></script>
@await RenderSectionAsync("Scripts", required: false)
</body>
</html>
@using AubgEMS.Core.Constants
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - AubgEMS</title>

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body class="d-flex flex-column min-vh-100">
@functions{
    // Area-aware "active" helper. Pass only what you want to match.
    string Active(string? controller = null, string? action = null, string? area = null)
    {
        var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
        var currentAction     = ViewContext.RouteData.Values["action"]?.ToString();
        var currentArea       = ViewContext.RouteData.Values["area"]?.ToString() ?? "";

        bool controllerMatch = controller is null || string.Equals(currentController, controller, StringComparison.OrdinalIgnoreCase);
        bool actionMatch     = action     is null || string.Equals(currentAction,     action,     StringComparison.OrdinalIgnoreCase);
        bool areaMatch       = area       is null || string.Equals(currentArea,       area,       StringComparison.OrdinalIgnoreCase);

        return (controllerMatch && actionMatch && areaMatch) ? "active" : "";
    }
}
@{
    var isSignedIn  = User?.Identity?.IsAuthenticated ?? false;
    var isAdmin     = User?.IsInRole(RoleNames.Admin) ?? false;
    var isOrganizer = User?.IsInRole(RoleNames.Organizer) ?? false;
}

<!-- Skip link for keyboard users -->
<a class="visually-hidden-focusable position-absolute top-0 start-0 p-2 m-2 bg-white border rounded"
   href="#content">Skip to main content</a>

<header class="sticky-top">
    <nav class="navbar navbar-expand-lg navbar-light navbar-glass fixed-top nav-underline">
        <div class="container-fluid">

            <!-- Brand -->
            <a class="navbar-brand fw-semibold" asp-area="" asp-controller="Home" asp-action="Index">
                AubgEMS
            </a>

            <!-- Mobile toggler opens the COLLAPSE below -->
            <button class="navbar-toggler" type="button"
                    data-bs-toggle="collapse" data-bs-target="#mainNav"
                    aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Collapse: visible inline ≥ lg, stacked on mobile -->
            <div id="mainNav" class="collapse navbar-collapse">
                <!-- Left: main nav -->
                <ul class="navbar-nav nav-underline me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        @{ var aHome = Active(controller: "Home", action: "Index", area: ""); }
                        <a class="nav-link @aHome"
                           aria-current="@(aHome == "active" ? "page" : null)"
                           asp-area="" asp-controller="Home" asp-action="Index">
                            <i class="bi bi-house"></i> Home
                        </a>
                    </li>

                    <li class="nav-item">
                        @{ var aEvents = Active(controller: "Events", area: ""); }
                        <a class="nav-link @aEvents"
                           aria-current="@(aEvents == "active" ? "page" : null)"
                           asp-area="" asp-controller="Events" asp-action="Index">
                            <i class="bi bi-calendar3"></i> Events
                        </a>
                    </li>

                    <!-- News before Clubs -->
                    <li class="nav-item">
                        @{ var aNews = Active(controller: "News", area: ""); }
                        <a class="nav-link @aNews"
                           aria-current="@(aNews == "active" ? "page" : null)"
                           asp-area="" asp-controller="News" asp-action="Index">
                            <i class="bi bi-newspaper"></i> News
                        </a>
                    </li>

                    <li class="nav-item">
                        @{ var aClubs = Active(controller: "Clubs", area: ""); }
                        <a class="nav-link @aClubs"
                           aria-current="@(aClubs == "active" ? "page" : null)"
                           asp-area="" asp-controller="Clubs" asp-action="Index">
                            <i class="bi bi-people"></i> Clubs
                        </a>
                    </li>

                    @if (isSignedIn)
                    {
                        <li class="nav-item">
                            @{ var aMy = Active(controller: "My", area: ""); }
                            <a class="nav-link @aMy"
                               aria-current="@(aMy == "active" ? "page" : null)"
                               asp-area="" asp-controller="My" asp-action="Events">
                                <i class="bi bi-star"></i> My Events
                            </a>
                        </li>
                    }

                    @if (isAdmin)
                    {
                        <li class="nav-item">
                            @{ var aAdmin = Active(area: "Admin"); }
                            <a class="nav-link @aAdmin"
                               aria-current="@(aAdmin == "active" ? "page" : null)"
                               asp-area="Admin" asp-controller="Dashboard" asp-action="Index">
                                <i class="bi bi-speedometer2"></i> Admin
                            </a>
                        </li>
                    }

                    @if (isOrganizer || isAdmin)
                    {
                        <li class="nav-item">
                            @{ var aOrg = Active(area: "Organizer"); }
                            <a class="nav-link @aOrg"
                               aria-current="@(aOrg == "active" ? "page" : null)"
                               asp-area="Organizer" asp-controller="Events" asp-action="Index">
                                <i class="bi bi-clipboard-check"></i> Organizer
                            </a>
                        </li>
                    }
                </ul>

                <div class="d-flex align-items-center gap-2 ms-auto">
                    <!-- Desktop search -->
                    <form asp-controller="Events" asp-action="Index" method="get" class="d-none d-lg-block">
                        <input name="Search"
                               class="form-control nav-search"
                               type="search"
                               placeholder="Search events…" />
                    </form>

                    <!-- Create Event (organizer/admin only) -->
                    @if (isOrganizer || isAdmin)
                    {
                        <a class="btn btn-primary btn-compact rounded-2 d-none d-md-inline-flex align-items-center"
                           asp-area="Organizer" asp-controller="Events" asp-action="Create">
                            <i class="bi bi-plus-lg me-2"></i>
                            <span class="text-nowrap">Create Event</span>
                        </a>
                    }

                    <!-- Auth -->
                    <div class="ms-1">
                        <partial name="_LoginPartial" />
                    </div>
                </div>
            </div>
        </div>
    </nav>
</header>

<div class="container flex-grow-1">
    <main id="content" role="main" class="pb-4">
        @RenderBody()
    </main>
</div>

<partial name="_Footer" />

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/js/site.js" asp-append-version="true"></script>
@await RenderSectionAsync("Scripts", required: false)
</body>
</html>
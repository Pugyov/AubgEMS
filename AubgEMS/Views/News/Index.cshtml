@using AubgEMS.Core.Models.Common
@using AubgEMS.Core.Models.News
@model PageResult<NewsListItemDto>

@{
    ViewData["Title"] = "News";

    var items = (Model?.Items ?? Enumerable.Empty<NewsListItemDto>()).ToList();

    // Safe lead/rest split without null-forgiving
    NewsListItemDto? lead = items.Count > 0 ? items[0] : null;
    var rest = items.Count > 1 ? items.Skip(1).ToList() : new List<NewsListItemDto>();
}

<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="mb-2">
  <ol class="breadcrumb small">
    <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
    <li class="breadcrumb-item active" aria-current="page">News</li>
  </ol>
</nav>

<!-- Section title -->
<h1 class="text-center mb-3 text-primary fw-bold text-uppercase" style="letter-spacing:.02em;">AUBG News</h1>

@if (!items.Any())
{
    @await Html.PartialAsync("_EmptyState", new AubgEMS.Models.EmptyStateViewModel {
        Icon = "bi-newspaper",
        Title = "No news yet",
        Message = "Once clubs start posting, you’ll see their updates here.",
        ActionText = "Browse events",
        ActionController = "Events",
        ActionAction = "Index"
    })
}
else
{
    <!-- Lead module: left text, right hero image -->
    @if (lead != null)
    {
        <div class="news-lead rounded-4 border bg-white shadow-sm p-3 p-lg-4 mb-4">
            <div class="row g-4 align-items-stretch">
                <!-- Left: lead text -->
                <div class="col-lg-5">
                    <div class="h-100 d-flex flex-column">
                        <a class="text-decoration-none" asp-controller="News" asp-action="Details" asp-route-id="@lead.Id">
                            <h2 class="lead-headline mb-2 text-primary">@lead.Title</h2>
                        </a>
                        <div class="text-muted small mb-2">
                            @lead.CreatedAtUtc.ToLocalTime().ToString("dd MMM yyyy · HH:mm")
                        </div>
                        <p class="mb-3 text-body-secondary">Latest headline from AUBG clubs and organizers.</p>
                        <div class="mt-auto">
                            <a class="btn btn-primary btn-lg px-3"
                               asp-controller="News" asp-action="Details" asp-route-id="@lead.Id">
                                Read full story
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Right: hero image -->
                <div class="col-lg-7">
                    <a class="d-block h-100 text-decoration-none"
                       asp-controller="News" asp-action="Details" asp-route-id="@lead.Id">
                        <div class="ratio rounded-top overflow-hidden" style="--bs-aspect-ratio: 56%;">
                            @if (!string.IsNullOrWhiteSpace(lead.ImageUrl))
                            {
                                <img class="img-cover" src="@lead.ImageUrl" alt="@lead.Title" />
                            }
                            else
                            {
                                <div class="img-placeholder"></div>
                            }
                        </div>
                    </a>
                </div>
            </div>
        </div>
    }

    <!-- Grid of more stories -->
    @if (rest.Any())
    {
        <div class="row g-4">
            @foreach (var n in rest)
            {
                <div class="col-12 col-md-6 col-lg-4">
                    <a class="card h-100 shadow-sm news-card text-decoration-none"
                       asp-controller="News" asp-action="Details" asp-route-id="@n.Id">
                        <div class="ratio" style="--bs-aspect-ratio: 56%;">
                            @if (!string.IsNullOrWhiteSpace(n.ImageUrl))
                            {
                                <img class="img-cover" src="@n.ImageUrl" alt="@n.Title" />
                            }
                            else
                            {
                                <div class="img-placeholder"></div>
                            }
                        </div>
                        <div class="card-body">
                            <div class="news-meta mb-1">
                                @n.CreatedAtUtc.ToLocalTime().ToString("dd MMM yyyy")
                            </div>
                            <h3 class="h6 mb-0 line-clamp-2">@n.Title</h3>
                        </div>
                    </a>
                </div>
            }
        </div>
    }

    <!-- Pager -->
    @if (Model.TotalCount > Model.PageSize)
    {
        <div class="d-flex justify-content-end mt-4">
            @await Html.PartialAsync("_Pager", new AubgEMS.Models.PagerViewModel {
                Page = Model.Page,
                PageSize = Model.PageSize,
                TotalCount = Model.TotalCount,
                Controller = "News",
                Action = "Index"
            })
        </div>
    }
}
@using AubgEMS.Core.Models.Common
@using AubgEMS.Core.Models.Events
@using AubgEMS.Core.Models.Clubs
@model AubgEMS.Core.Models.Clubs.ClubDetailsPageVm

@{
    ViewData["Title"] = Model.Club.Name;

    var totalPages  = (int)Math.Ceiling((double)Model.Events.TotalCount / Model.Events.PageSize);
    var page        = Model.Events.Page;
    var pageSize    = Model.Events.PageSize;
    var prevDisabled = page <= 1 ? "disabled" : "";
    var nextDisabled = page >= totalPages ? "disabled" : "";
}

<h1 class="mb-1">@Model.Club.Name</h1>
<p class="text-muted mb-4">
    <strong>Department:</strong> @Model.Club.DepartmentName
</p>

@if (!string.IsNullOrWhiteSpace(Model.Club.Description))
{
    <p class="mb-4">@Model.Club.Description</p>
}

<h4 class="mb-3">Events</h4>

@if (!Model.Events.Items.Any())
{
    <div class="alert alert-info">This club has no events yet.</div>
}
else
{
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th>Title</th>
                <th>Start</th>
                <th>Type</th>
                <th>Location</th>
                <th style="width: 120px;"></th>
            </tr>
        </thead>
        <tbody>
        @foreach (var e in Model.Events.Items)
        {
            <tr>
                <td>@e.Title</td>
                <td>@e.StartTime.ToString("yyyy-MM-dd HH:mm")</td>
                <td>@e.EventTypeName</td>
                <td>@(e.LocationName ?? "-")</td>
                <td class="text-end">
                    <a class="btn btn-sm btn-outline-secondary"
                       asp-controller="Events"
                       asp-action="Details"
                       asp-route-id="@e.Id">View</a>
                </td>
            </tr>
        }
        </tbody>
    </table>

    @if (totalPages > 1)
    {
        <nav aria-label="pager">
            <ul class="pagination">
                <li class="page-item @prevDisabled">
                    <a class="page-link"
                       asp-action="Details"
                       asp-route-id="@Model.Club.Id"
                       asp-route-page="@(page - 1)"
                       asp-route-pageSize="@pageSize">Prev</a>
                </li>

                <li class="page-item disabled">
                    <span class="page-link">Page @(page) of @(totalPages)</span>
                </li>

                <li class="page-item @nextDisabled">
                    <a class="page-link"
                       asp-action="Details"
                       asp-route-id="@Model.Club.Id"
                       asp-route-page="@(page + 1)"
                       asp-route-pageSize="@pageSize">Next</a>
                </li>
            </ul>
        </nav>
    }
}
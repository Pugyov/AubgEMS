@using AubgEMS.Core.Models.Common
@using AubgEMS.Core.Models.Events
@using AubgEMS.Core.Models.Clubs
@model AubgEMS.Core.Models.Clubs.ClubDetailsPageVm

@{
    ViewData["Title"] = Model.Club.Name;

    var totalPages  = (int)Math.Ceiling((double)Model.Events.TotalCount / Model.Events.PageSize);
    var page        = Model.Events.Page;
    var pageSize    = Model.Events.PageSize;
}

<!-- Header -->
<nav aria-label="breadcrumb" class="mb-2">
  <ol class="breadcrumb small">
    <li class="breadcrumb-item">
      <a asp-controller="Home" asp-action="Index">Home</a>
    </li>
    <li class="breadcrumb-item">
      <a asp-controller="Clubs" asp-action="Index">Clubs</a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">@Model.Club.Name</li>
  </ol>
</nav>

<div class="mb-3">
  <h1 class="page-title">@Model.Club.Name</h1>
  <p class="page-subtitle">Department: @Model.Club.DepartmentName</p>
</div>

@if (!string.IsNullOrWhiteSpace(Model.Club.Description))
{
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <p class="mb-0">@Model.Club.Description</p>
        </div>
    </div>
}

<h2 class="h5 mb-3">Events</h2>

@if (!Model.Events.Items.Any())
{
    @await Html.PartialAsync("_EmptyState", new AubgEMS.Models.EmptyStateViewModel {
        Icon = "bi-calendar2-x",
        Title = "No upcoming events",
        Message = "This club hasn’t scheduled any events yet."
    })
}
else
{
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
        @foreach (var e in Model.Events.Items)
        {
            <div class="col">
                @await Html.PartialAsync("_EventCard", e, new ViewDataDictionary(ViewData) {
                    ["DetailsText"] = "View"
                })
            </div>
        }
    </div>

    <div class="d-flex justify-content-between align-items-center mt-4">
        <div class="text-muted">
            Page @Model.Events.Page • @Model.Events.TotalCount total
        </div>

        @{
            var routes = new Dictionary<string,string?> {
                ["id"] = Model.Club.Id.ToString()
            };
        }
        @await Html.PartialAsync("_Pager", new AubgEMS.Models.PagerViewModel {
            Page = Model.Events.Page,
            PageSize = Model.Events.PageSize,
            TotalCount = Model.Events.TotalCount,
            Controller = "Clubs",
            Action = "Details",
            RouteValues = routes
        })
    </div>
}